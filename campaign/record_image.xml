<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
    Please see the license.html file included with this distribution for 
    attribution and copyright information.
-->

<root>
    <windowclass name="imagewindow" version="&gt;=4" merge="join">
        <!-- <script>
            function onInit()
                super.onInit();
                Debug.chat(image.getTokens());
                for k,v in pairs(image.getTokens()) do
                    Debug.chat(v.getPrototype());
                end
            end
        </script> -->
    </windowclass>
    <windowclass name="imagewindow_toolbar" version="&gt;=4" merge="join">
        <script>
            function onInit()
                super.onInit();
                h6.setVisible(true);
            end
        </script>
        <sheetdata>
            <image_toolbar_separator name="h6" />
            <image_toolbar_button name="rank_position">
                <script>
                    function onInit()
                        local sColor;
                        if iconcolor and iconcolor[1] then
                            sColor = "FF" .. iconcolor[1];
                        else
                            sColor = "FFFFFFFF";
                        end

                        setStateIcons(0, "icon_rank_right")
                        setStateColor(0, sColor)
                        setStateIcons(1, "icon_rank_left")
                        setStateColor(1, sColor)
                        setStateIcons(2, "icon_rank_top")
                        setStateColor(2, sColor)
                        setStateIcons(3, "icon_rank_bottom")
                        setStateColor(3, sColor)

                        setValue(DB.getValue(window.parentcontrol.window.getDatabaseNode(), "rank_position", 0));
                    end

                    function onValueChanged()
                        DB.setValue(window.parentcontrol.window.getDatabaseNode(), "rank_position", "number", getValue())
                        WarfareManager.updateTokensOnMap(window.parentcontrol.window)
                    end
                </script>
            </image_toolbar_button>
        </sheetdata>
    </windowclass>

    <!-- <windowclass name="warfare_rowlink">
        <script file="campaign/scripts/warfare_rowlink.lua" />
        <sheetdata>
            <hn name="imagex" />
			<hn name="imagey" />
            <hnc name="imageid" />
            <hlink name="imageref" />
            <tokenfield name="token">
                <script>
                    function onDragStart(button, x, y, draginfo)
                        Debug.chat(window.parent);

                        draginfo.setType("token");
                        if icon and icon[1] then
                            draginfo.setIcon(icon[1]);
                        end
                        if token and token[1] then
                            draginfo.setTokenData(token[1]);
                        end
					end
					
					function onDragEnd(draginfo)						
						local _,dropref = draginfo.getTokenData();
						window.setLink(dropref);
						return true;
					end
                </script>
                <bounds>0,0,34,34</bounds>
                <empty>token_vanguard_friend</empty>
                <readonly />
                <nodrop />
            </tokenfield>
            <buttoncontrol name="linked">
				<bounds>2,2,24,24</bounds>
				<invisible />
				<icon normal="poll_check" pressed="poll_check" />
				<script>
					function onButtonPress()
						if Session.IsHost then
							window.clearLink();
						end
					end
				</script>
			</buttoncontrol>
        </sheetdata>
    </windowclass> -->
</root>
